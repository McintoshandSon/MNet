<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MNet</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { height: 100%; }

    /* Top Navigation Bar */
    .top-bar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background-color: #0d0d17;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: right; /* Buttons aligned left */
      padding: px px;
      gap: 8px;
    }

    /* Coverage Button styling */
    .coverage-btn {
      width: 42px;
      height: 42px;
      border: none;
      outline: none;
      cursor: pointer;
      background: #fff;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: #1f3763;
    }
    .coverage-btn span {
      position: absolute;
      bottom: 4px;
      font-weight: bold;
    }

    /* State 0: Empty circle */
    .cov-state-0::before {
      content: "";
      width: 20px;
      height: 20px;
      border: 2px solid #b0b0b0;
      border-radius: 50%;
      position: absolute;
    }

    /* States 1â€“6: small blue dot + number (5..30) */
    [class^="cov-state-"]:not(.cov-state-0):not(.cov-state-7):not(.cov-state-8)::before {
      content: "";
      width: 10px;
      height: 10px;
      background: #1f3763;
      border-radius: 50%;
      position: absolute;
      top: 10px;
    }

    /* State 7: filled dark blue circle + number 50 */
    .cov-state-7::before {
      content: "";
      width: 20px;
      height: 20px;
      background: #1f3763;
      border-radius: 50%;
      position: absolute;
      top: 6px;
    }
    .cov-state-7 span { color: white; }

    /* State 8: concentric blue shades (simulation icon) */
    .cov-state-8::before {
      content: "";
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: radial-gradient(
        circle,
        rgba(31,55,99,0.6) 0%,
        rgba(31,55,99,0.3) 50%,
        rgba(31,55,99,0.1) 100%
      );
      position: absolute;
    }

    .map-control-panel {
      position: absolute;
      top: 70px; /* below top bar */
      right: 20px;
      z-index: 1000;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 5px;
      align-items: center;
    }
    .control-button {
      background: #fff;
      border: none;
      border-radius: 50%;
      width: 26px;
      height: 26px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .control-button:hover { background: #eee; }
    .control-button img, .control-button span {
      width: 14px;
      height: 14px;
      font-size: 14px;
      line-height: 14px;
    }

    .map-options {
      position: absolute;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 8px;
      display: none;
      flex-direction: column;
      gap: 6px;
    }
    .map-options button {
      font-weight: bold;
      background: #f0f0f0;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .map-options button:hover { background: #ddd; }
  </style>
</head>
<body>
  <!-- Top Navigation Bar -->
  <div class="top-bar">
    <!-- Left side -->
    <div class="top-left">
      <button id="coverageBtn" class="coverage-btn cov-state-0">
        <span></span>
      </button>
    </div>

    <!-- Right side -->
    <div class="top-right">
      <button id="measureBtn" class="coverage-btn" title="Measure Distance">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" 
            xmlns="http://www.w3.org/2000/svg">
          <path d="M14.5 5.49989L16 6.99989M11.5 8.49989L13 9.99989M8.49996 11.4999L9.99996 12.9999M5.49996 14.4999L6.99996 15.9999M2.56561 17.5656L6.43424 21.4342C6.63225 21.6322 6.73125 21.7313 6.84542 21.7683C6.94584 21.801 7.05401 21.801 7.15443 21.7683C7.2686 21.7313 7.3676 21.6322 7.56561 21.4342L21.4342 7.56561C21.6322 7.3676 21.7313 7.2686 21.7683 7.15443C21.801 7.05401 21.801 6.94584 21.7683 6.84542C21.7313 6.73125 21.6322 6.63225 21.4342 6.43424L17.5656 2.56561C17.3676 2.3676 17.2686 2.2686 17.1544 2.2315C17.054 2.19887 16.9458 2.19887 16.8454 2.2315C16.7313 2.2686 16.6322 2.3676 16.4342 2.56561L2.56561 16.4342C2.3676 16.6322 2.2686 16.7313 2.2315 16.8454C2.19887 16.9458 2.19887 17.054 2.2315 17.1544C2.2686 17.2686 2.3676 17.3676 2.56561 17.5656Z" 
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Map Container -->
  <div id="map"></div>

  <!-- Combined Map Control Panel -->
  <div class="map-control-panel">
    <button class="control-button" onclick="locateMe()">
      <img src="https://cdn-icons-png.flaticon.com/512/684/684908.png" alt="Locate"/>
    </button>
    <button class="control-button" onclick="map.zoomIn()"><span>+</span></button>
    <button class="control-button" onclick="map.zoomOut()"><span>âˆ’</span></button>
    <button class="control-button" onclick="toggleMapOptions()"><span>ðŸ—º</span></button>
  </div>

  <!-- Map type selection panel -->
  <div class="map-options" id="mapOptions">
    <button onclick="switchLayer('street')">Street</button>
    <button onclick="switchLayer('satellite')">Satellite</button>
    <button onclick="switchLayer('hybrid')">Hybrid</button>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Create the map + helpers BEFORE loading base-stations.js -->
  <script>
    // Base layers
    const street = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    });
    const satellite = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      { attribution: 'Imagery &copy; Esri' }
    );
    const esriLabels = L.tileLayer(
      'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',
      { attribution: 'Labels &copy; Esri' }
    );
    const esriRoads = L.tileLayer(
      'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}',
      { attribution: 'Roads &copy; Esri' }
    );
    const hybrid = L.layerGroup([satellite, esriRoads, esriLabels]);

    // Map
    window.map = L.map('map', {
      zoom: 10,
      layers: [hybrid],
      zoomControl: false
    });


    // âœ… Smoother camera moves (must come AFTER map is created)
    map.options.zoomSnap = 0.15;
    map.options.zoomDelta = 0.15;
    map.options.zoomAnimation = true;
    map.options.easeLinearity = 0.15;


    // Geolocate user
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        ({ coords }) => map.setView([coords.latitude, coords.longitude], 13),
        () => map.setView([-27.4698, 153.0251], 10) // Brisbane fallback
      );
    } else {
      map.setView([-27.4698, 153.0251], 10);
    }

    // Switch base layers
    function switchLayer(type) {
      map.eachLayer(l => map.removeLayer(l));
      if (type === 'street') map.addLayer(street);
      if (type === 'satellite') map.addLayer(satellite);
      if (type === 'hybrid') map.addLayer(hybrid);
    }

    // Toggle map options panel
    function toggleMapOptions() {
      const panel = document.getElementById('mapOptions');
      panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
    }

    // Center map on user
    function locateMe() {
      if (!navigator.geolocation) { alert("Geolocation is not supported by your browser."); return; }
      navigator.geolocation.getCurrentPosition(
        ({ coords }) => {
          map.setView([coords.latitude, coords.longitude], 15);
          L.marker([coords.latitude, coords.longitude]).addTo(map)
            .bindPopup("You are here").openPopup();
        },
        err => alert("Unable to retrieve your location.\n" + err.message)
      );
    }
  </script>

  <!-- Your base station code (updated) -->
  <script src="js/base-stations.js"></script>
  <script src="js/address-search.js"></script>
</body>
</html>
